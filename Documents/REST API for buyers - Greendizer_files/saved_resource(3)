(function(){var E=new function(){function a(b){return i(l(h(b),8*b.length))}function c(a,b){var c=h(a);16<c.length&&(c=l(c,8*a.length));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=c[f]^909522486,e[f]=c[f]^1549556828;c=l(d.concat(h(b)),512+8*b.length);return i(l(e.concat(c),640))}function d(a){for(var b=(q=q||0)?"0123456789ABCDEF":"0123456789abcdef",c="",d,e=0;e<a.length;e++)d=a.charCodeAt(e),c+=b.charAt(d>>>4&15)+b.charAt(d&15);return c}function f(a){s=s||"";for(var b="",c=a.length,d=0;d<c;d+=3)for(var e=a.charCodeAt(d)<<16|(d+1<c?a.charCodeAt(d+1)<<8:0)|(d+2<c?a.charCodeAt(d+2):0),f=0;4>f;f++)b=8*d+6*f>8*a.length?b+s:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6*(3-f)&63);return b}function e(a,b){var c=b.length,d,e,f,h,g,i=Array(Math.ceil(a.length/2));for(d=0;d<i.length;d++)i[d]=a.charCodeAt(2*d)<<8|a.charCodeAt(2*d+1);var l=Math.ceil(8*a.length/(Math.log(b.length)/Math.log(2))),n=Array(l);for(e=0;e<l;e++){g=[];for(d=h=0;d<i.length;d++)if(h=(h<<16)+
i[d],f=Math.floor(h/c),h-=f*c,0<g.length||0<f)g[g.length]=f;n[e]=h;i=g}c="";for(d=n.length-1;0<=d;d--)c+=b.charAt(n[d]);return c}function g(a){for(var b="",c=-1,d,e;++c<a.length;)d=a.charCodeAt(c),e=c+1<a.length?a.charCodeAt(c+1):0,55296<=d&&56319>=d&&56320<=e&&57343>=e&&(d=65536+((d&1023)<<10)+(e&1023),c++),127>=d?b+=String.fromCharCode(d):2047>=d?b+=String.fromCharCode(192|d>>>6&31,128|d&63):65535>=d?b+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(b+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return b}function h(a){for(var b=Array(a.length>>2),d=0;d<b.length;d++)b[d]=0;for(d=0;d<8*a.length;d+=8)b[d>>5]|=(a.charCodeAt(d/8)&255)<<d%32;return b}function i(a){for(var b="",d=0;d<32*a.length;d+=8)b+=String.fromCharCode(a[d>>5]>>>d%32&255);return b}function l(a,b){a[b>>5]|=128<<b%32;a[(b+64>>>9<<4)+14]=b;for(var d=1732584193,c=-271733879,e=-1732584194,f=271733878,h=0;h<a.length;h+=16)var g=d,i=c,l=e,q=f,d=j(d,c,e,f,a[h+0],7,-680876936),f=j(f,d,c,e,a[h+1],12,-389564586),e=j(e,f,d,c,a[h+2],17,606105819),c=j(c,e,f,d,a[h+3],22,-1044525330),d=j(d,c,e,f,a[h+4],7,-176418897),f=j(f,d,c,e,a[h+5],12,1200080426),e=j(e,f,d,c,a[h+6],17,-1473231341),c=j(c,e,f,d,a[h+7],22,-45705983),d=j(d,c,e,f,a[h+8],7,1770035416),f=j(f,d,c,e,a[h+9],12,-1958414417),e=j(e,f,d,c,a[h+10],17,-42063),c=j(c,e,f,d,a[h+11],22,-1990404162),d=j(d,c,e,f,a[h+12],7,1804603682),f=j(f,d,c,e,a[h+13],12,-40341101),e=j(e,f,d,c,a[h+14],17,-1502002290),c=j(c,e,f,d,a[h+15],22,1236535329),d=m(d,c,e,f,a[h+1],5,-165796510),f=m(f,d,c,e,a[h+6],9,-1069501632),e=m(e,f,d,c,a[h+11],14,643717713),c=m(c,e,f,d,a[h+0],20,-373897302),d=m(d,c,e,f,a[h+5],5,-701558691),f=m(f,d,c,e,a[h+10],9,38016083),e=m(e,f,d,c,a[h+15],14,-660478335),c=m(c,e,f,d,a[h+4],20,-405537848),d=m(d,c,e,f,a[h+9],5,568446438),f=m(f,d,c,e,a[h+14],9,-1019803690),e=m(e,f,d,c,a[h+3],14,-187363961),c=m(c,e,f,d,a[h+8],20,1163531501),d=m(d,c,e,f,a[h+13],5,-1444681467),f=m(f,d,c,e,a[h+2],9,-51403784),e=m(e,f,d,c,a[h+7],14,1735328473),c=m(c,e,f,d,a[h+12],20,-1926607734),d=n(c^e^f,d,c,a[h+5],4,-378558),f=n(d^c^e,f,d,a[h+8],11,-2022574463),e=n(f^d^c,e,f,a[h+11],16,1839030562),c=n(e^f^d,c,e,a[h+14],23,-35309556),d=n(c^e^f,d,c,a[h+1],4,-1530992060),f=n(d^c^e,f,d,a[h+4],11,1272893353),e=n(f^d^c,e,f,a[h+7],16,-155497632),c=n(e^f^d,c,e,a[h+10],23,-1094730640),d=n(c^e^f,d,c,a[h+13],4,681279174),f=n(d^c^e,f,d,a[h+0],11,-358537222),e=n(f^d^c,e,f,a[h+3],16,-722521979),c=n(e^f^d,c,e,a[h+6],23,76029189),d=n(c^e^f,d,c,a[h+9],4,-640364487),f=n(d^c^e,f,d,a[h+12],11,-421815835),e=n(f^d^c,e,f,a[h+15],16,530742520),c=n(e^f^d,c,e,a[h+2],23,-995338651),d=o(d,c,e,f,a[h+0],6,-198630844),f=o(f,d,c,e,a[h+7],10,1126891415),e=o(e,f,d,c,a[h+14],15,-1416354905),c=o(c,e,f,d,a[h+5],21,-57434055),d=o(d,c,e,f,a[h+12],6,1700485571),f=o(f,d,c,e,a[h+3],10,-1894986606),e=o(e,f,d,c,a[h+10],15,-1051523),c=o(c,e,f,d,a[h+1],21,-2054922799),d=o(d,c,e,f,a[h+8],6,1873313359),f=o(f,d,c,e,a[h+15],10,-30611744),e=o(e,f,d,c,a[h+6],15,-1560198380),c=o(c,e,f,d,a[h+13],21,1309151649),d=o(d,c,e,f,a[h+4],6,-145523070),f=o(f,d,c,e,a[h+11],10,-1120210379),e=o(e,f,d,c,a[h+2],15,718787259),c=o(c,e,f,d,a[h+9],21,-343485551),d=r(d,g),c=r(c,i),e=r(e,l),f=r(f,q);return[d,c,e,f]}function n(a,b,d,c,e,f){a=r(r(b,a),r(c,f));return r(a<<e|a>>>32-e,d)}function j(a,b,d,c,e,f,h){return n(b&d|~b&c,a,b,e,f,h)}function m(a,b,d,c,e,f,h){return n(b&c|d&~c,a,b,e,f,h)}function o(a,b,d,c,e,f,h){return n(d^(b|~c),a,b,e,f,h)}function r(a,b){var d=(a&65535)+(b&65535);return(a>>16)+(b>>16)+
(d>>16)<<16|d&65535}var q=0,s="";this.hex_md5=function(c){return d(a(g(c)))};this.b64_md5=function(d){return f(a(g(d)))};this.any_md5=function(d,c){return e(a(g(d)),c)};this.hex_hmac_md5=function(a,b){return d(c(g(a),g(b)))};this.b64_hmac_md5=function(a,b){return f(c(g(a),g(b)))};this.any_hmac_md5=function(a,b,d){return e(c(g(a),g(b)),d)}},B=new function(){function a(b){for(var d=Array(b.length>>2),c=0;c<d.length;c++)d[c]=0;for(c=0;c<8*b.length;c+=8)d[c>>5]|=(b.charCodeAt(c/8)&255)<<24-c%32;b=8*b.length;d[b>>5]|=128<<24-b%32;d[(b+64>>9<<4)+15]=b;for(var b=Array(80),c=1732584193,e=-271733879,g=-1732584194,m=271733878,o=-1009589776,r=0;r<d.length;r+=16){for(var q=c,s=e,t=g,u=m,y=o,p=0;80>p;p++){b[p]=16>p?d[r+p]:(b[p-3]^b[p-8]^b[p-14]^b[p-16])<<1|(b[p-3]^b[p-8]^b[p-14]^b[p-16])>>>31;var w=c<<5|c>>>27,z;z=20>p?e&g|~e&m:40>p?e^g^m:60>p?e&g|e&m|g&m:e^g^m;w=f(f(w,z),f(f(o,b[p]),20>p?1518500249:40>p?1859775393:60>p?-1894007588:-899497514));o=m;m=g;g=e<<30|e>>>2;e=c;c=w}c=f(c,q);e=f(e,s);g=f(g,t);m=f(m,u);o=f(o,y)}d=[c,e,g,m,o];b="";for(c=0;c<32*d.length;c+=8)b+=String.fromCharCode(d[c>>5]>>>24-c%32&255);return b}function c(a){g=g||"";for(var b="",d=a.length,c=0;c<d;c+=3)for(var e=a.charCodeAt(c)<<16|(c+1<d?a.charCodeAt(c+1)<<8:0)|(c+2<d?a.charCodeAt(c+2):0),f=0;4>f;f++)b=8*c+6*f>8*a.length?b+g:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6*(3-f)&63);return b}function d(a){for(var b="",d=-1,c,e;++d<a.length;)c=a.charCodeAt(d),e=d+1<a.length?a.charCodeAt(d+1):0,55296<=c&&56319>=c&&56320<=e&&57343>=e&&(c=65536+((c&1023)<<10)+(e&1023),d++),127>=c?b+=String.fromCharCode(c):2047>=c?b+=String.fromCharCode(192|c>>>6&31,128|c&63):65535>=c?b+=String.fromCharCode(224|c>>>12&15,128|c>>>6&63,128|c&63):2097151>=c&&(b+=String.fromCharCode(240|c>>>18&7,128|c>>>12&63,128|c>>>6&63,128|c&63));return b}function f(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}var e=0,g="";this.hex_sha1=function(c){for(var c=a(d(c)),f=(e=e||0)?"0123456789ABCDEF":"0123456789abcdef",g="",n,j=0;j<c.length;j++)n=c.charCodeAt(j),g+=f.charAt(n>>>4&15)+f.charAt(n&15);return g};this.b64_sha1=function(e){return c(a(d(e)))};this.b64=function(a){return c(a)}};window.greendizer=window.greendizer||{};var a=window.greendizer;a.base=a.base||{};a.dal=a.dal||{};a.http=a.http||{};a.oauth=a.oauth||{};a.resources=a.resources||{};a.resources.buyers=a.resources.buyers||{};a.resources.sellers=a.resources.sellers||{};a.localization=a.localization||{};(function(){var b=function(b,d){switch(d){case"d":return b.getDate().toString();case"dd":return b.getDate().toLeadingZeroString();case"ddd":return a.localization.findCultureString("AbbreviatedDayNames")[b.getDay()];case"dddd":return a.localization.findCultureString("DayNames")[b.getDay()];case"f":return b.getMilliseconds().toString();case"ff":return b.getMilliseconds().toLeadingZeroString();case"L":return b.getMilliseconds().toLeadingZeroString(3);case"h":return(b.getHours()+11)%12+1;case"hh":return((b.getHours()+11)%12+1).toLeadingZeroString();case"H":return b.getHours().toString();case"HH":return b.getHours().toLeadingZeroString();case"m":return b.getMinutes().toString();case"mm":return b.getMinutes().toLeadingZeroString();case"M":return(b.getMonth()+1).toString();case"MM":return(b.getMonth()+1).toLeadingZeroString();case"MMM":return a.localization.findCultureString("AbbreviatedMonthNames")[b.getMonth()];case"MMMM":return a.localization.findCultureString("MonthNames")[b.getMonth()];case"s":return b.getSeconds().toString();case"ss":return b.getSeconds().toLeadingZeroString();case"t":return a.localization.findCultureString(12>=b.getHours()?"ShortAMDesignator":"ShortPMDesignator");case"tt":return a.localization.findCultureString(12>=b.getHours()?"LongAMDesignator":"LongPMDesignator");case"y":return b.getFullYear().toString().substr(2);case"yy":return b.getFullYear().toString();case"z":return(0>b.getTimezoneOffset()?String.EMPTY:"+")+(b.getTimezoneOffset()/60).toString();case"zz":return(0>b.getTimezoneOffset()?String.EMPTY:"+")+(b.getTimezoneOffset()/60).toLeadingZeroString();case"zzz":return(0>b.getTimezoneOffset()?String.EMPTY:"+")+(b.getTimezoneOffset()/60).toLeadingZeroString()+":00"}};Date.prototype.toString=function(c){c=c||"%HTTP";switch(c){case"%LongDate":c=a.localization.findCultureString("LongDateFormat");break;case"%ShortDate":c=a.localization.findCultureString("ShortDateFormat");break;case"%LongTime":c=a.localization.findCultureString("LongTimeFormat");break;case"%ShortTime":c=a.localization.findCultureString("ShortTimeFormat");break;case"%ShortFullDate":c=a.localization.findCultureString("ShortFullDateFormat");break;case"%LongFullDate":c=a.localization.findCultureString("LongFullDateFormat");break;case"%XMLDate":c="yy-MM-dd";break;case"%XMLTime":c="HH:mm:ss.L";break;case"%XML":case"%ISO8601":return(new Date(this.getTime()+6E4*this.getTimezoneOffset())).toString("yy-MM-ddTHH:mm:ss.LZ");case"%HTTP":return this.toUTCString()}var d=null;for(a.regexp.dateFormat.lastIndex=0;d=a.regexp.dateFormat.exec(c);){var d=d.toString(),f=b(this,d),c=c.substr(0,a.regexp.dateFormat.lastIndex-d.length)+f+c.substr(a.regexp.dateFormat.lastIndex);a.regexp.dateFormat.lastIndex=a.regexp.dateFormat.lastIndex-d.length+f.length}return c}})();Date.parseISO8601=function(a){var c=a.substr(0,a.indexOf("T")).split("-"),a=a.replace("Z","").substr(a.indexOf("T")+1).split(":"),d=a[2].split("."),f=new Date(0);f.setUTCFullYear(Number(c[0]));f.setUTCMonth(Number(c[1])-1);f.setUTCDate(Number(c[2]));f.setUTCHours(Number(a[0]));f.setUTCMinutes(Number(a[1]));f.setUTCSeconds(Number(d[0]));1<d.length&&f.setUTCMilliseconds(Number(d[1])/1E3);return f};Date.today=function(){var a=Date.now();return new Date(a.getFullYear(),a.getMonth(),a.getDate())};Date.daysInMonth=function(a,c){if(1===Number(a)){var d=new Date(c,a,29);return 29===d.getDate()?29:28}d=new Date(c,a,31);return 31===d.getDate()?31:30};Date.prototype.getDayDate=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate())};Date.prototype.substract=function(b,c){return c?new a.base.Timespan(this.getDayDate(),b.getDayDate()):new a.base.Timespan(this,b)};a.EndPoints={OAUTH_SERVICE:"https://services.greendizer.com/oauth/",SDK_FRAME:"https://api.greendizer.com/"};Number.prototype.toLeadingZeroString=function(a){for(var a=a||2,c=Math.abs(this).toString();c.length<a;)c="0"+c;return String.format("{0}{1}",0>this?"-":String.EMPTY,c)};Number.format=function(a,c){for(var c=c||{},d=isNaN(c.precision)?2:Math.min(Math.max(0,c.precision),15),f=Math.pow(10,d),e=(Math.round(Math.abs(a)*f)/f).toString().split("."),f=e[0].split("").reverse(),e=1===e.length?[]:e[1].split(""),g=[];f.length;)g.length&&g.push(c.thousandSep||","),g=g.concat(f.splice(0,3));0>a&&g.push("-");g.reverse();if(e.length>d)e=e.slice(0,d);else for(;e.length<d;)e.push("0");e.length&&e.splice(0,0,c.decimalSep||".");return g.concat(e).join("")};Number.toCurrency=function(a,c){var c=c||{},d=c.pattern||"s$N",d=d.replace("N",Number.format(Math.abs(a),c)),d=d.replace("$",c.symbol||"&curren;");return d.replace("s",0>a?c.sign||"-":String.EMPTY)};Object.isNullOrUndefined=function(a){return null===a||void 0===a};Object.getCount=function(a){var c=0,d;for(d in a)d&&c++;return c};Object.getKeys=function(a){var c=[],d;for(d in a)c.push(d);return c};String.EMPTY="";String.SPACE=" ";String.isNullOrEmpty=function(a){return Object.isNullOrUndefined(a)||!a.length};String.prototype.toSHA1=function(){return a.base.hash.sha1(this)};String.prototype.toMD5=function(){return a.base.hash.md5(this)};String.prototype.capitalize=function(){for(var a=this.substr(0),c=this.search(RegExp("[ -][a-z]","g")),d=0;d<c.length;d++)a.replace(c[d],c[d].toUpperCase());return a};String.prototype.startsWith=function(a){return this.substr(0,a.length)===a};String.prototype.endsWith=function(a){return this.substr(this.length-a.length)===a};String.prototype.contains=function(a,c){return RegExp(a,c?"":"i").test(this)};String.prototype.isValidEmail=function(){return a.regexp.emailFormat.test(this)};String.format=function(){for(var b=arguments[0],c;c=a.regexp.compositeFormat.exec(b);){var d=Number(c[1])+1;if(d>=arguments.length)throw Error("Found "+(arguments.length-2)+" parameters while more were expected.");b=b.replace(RegExp("[{]"+c[0].substr(1,c[0].length-2)+"[}]","g"),c[2]?arguments[d].toString(c[2].substr(1)):arguments[d].toString())}return b};a.Client=function(b,c){if(0>$.inArray(b,Object.getKeys(a.types)))throw Error("Invalid client type.");c=$.extend({"protected":!0,timeouts:!0,autologin:!0,unauthorized:!0,cache:!1,storageEngine:{engine:window.sessionStorage,getItem:function(a){try{return this.engine.getItem(a)}catch(b){return!1}},setItem:function(a,b){try{this.engine.setItem(a,b)}catch(d){return!1}},removeItem:function(a){try{this.engine.removeItem(a)}catch(b){return!1}},clear:function(){try{this.engine.clear()}catch(a){return!1}}}},c||{});c.cache=!0===c.cache&&window.localStorage&&window.sessionStorage;var d=Object.getKeys(a.types[b]),f=new a.http.RequestQueue(this),e=new a.http.RequestQueue(this),g={};this.signRequest=function(){};this.getUnauthorizedRequestQueue=function(){return f};this.getTimeoutRequestQueue=function(){return e};this.getOption=function(a){return c[a]};this.getUser=function(d,c,e){return this.getContainerByType(b).findResource(this.getUserID(),d,c,e||function(b,d){return new a.resources.User(b,d)})};this.getType=function(){return b};this.getTunnel=function(){throw Error("No tunnel has been specified for the current client.");};this.getAuthorizationHeader=function(){};this.getContainerByType=function(a){if(void 0===g[a])throw Error(String.format("Invalid resource type ({0}).",a));return g[a]};this.init=function(b){for(var c=d.length,e=function(){c--;!c&&b&&b()},f=0;f<d.length;f++){var j=new a.dal.Container(this,d[f]);g[d[f]]=j;j.init(e)}};this.reset=function(){f=new a.http.RequestQueue(this);e=new a.http.RequestQueue(this);for(var b in g)g[b].empty();g={}}};a.Tunnel=function(){var b,c=function(){var b="beforeSend,context,dataFilter,isLocal,statusCode,xhr,username,password".split(","),c=["success","error","complete"],e=document.createElement("iframe"),g={},h=!1,i=[],l,n=$(window),j=function(a,b){return{status:b.status,responseText:b.responseText,abort:function(){var b={id:a,type:"abort_ajax"};e&&e.contentWindow.postMessage(b,l)},getResponseHeader:function(a){return b.headers[a.replace("-","_").toLowerCase()]||null},getAllResponseHeaders:function(){var a=[],d;for(d in b.headers)a.push(d.replace("_","-")+": "+b.headers[d]);return a.join("\n")+"\n"}}},m=function(b){if(b.origin===a.base.extractDomain(e.src)&&(e&&e.removeAttribute("name"),b=JSON.parse(b.data||""),"start_ajax_response"===b.type&&g[b.id]))switch(b.event){case"success":g[b.id].success(b.data,b.textStatus,j(b.id,b.xhr));delete g[b.id];n.trigger("ajaxSuccess");n.trigger("ajaxStop");break;case"error":g[b.id].error(j(b.id,b.xhr),b.textStatus);delete g[b.id];n.trigger("ajaxError");n.trigger("ajaxStop");break;case"complete":g[b.id].complete(j(b.id,b.xhr)),n.trigger("ajaxComplete"),n.trigger("ajaxStop")}};this.init=function(b){if(h)return b&&b();i.push(b);if(!(1<i.length))"addEventListener"in window?window.addEventListener("message",m,!1):window.attachEvent("onmessage",m),b=["d="+a.base.extractDomain(document.location.href)],e.name=b.join("&"),e.src=a.EndPoints.SDK_FRAME,l=a.base.extractDomain(e.src),e.style.display="none",e.onload=function(){h=!0;for(var a=0;a<i.length;a++)i[a]&&i[a]();i=[]},document.body.appendChild(e)};this.kill=function(){h&&(document.body.removeChild(e),e=document.createElement("iframe"),h=!1,l=void 0,g={})};this.ajax=function(h){for(var i=0;i<b.length;i++)b[i]in h&&delete h[b[i]];i=a.base.createGUID();g[i]={};for(var q=0;q<c.length;q++)c[q]in h&&(g[i][c[q]]=h[c[q]],h[c[q]]=!0);h={id:i,type:"start_ajax",options:h};n.trigger("ajaxStart");e.contentWindow.postMessage(JSON.stringify(h),l);return j(i,{})}};return new function(){this.getInstance=function(a){if(!b)b=new c(a||!1),b.constructor=null;return b}}}();a.defaults={responseMaxSize:200};a.localization.findCultureString=function(a){try{return eval("window.greendizer.localization.currentCulture."+a)||eval("window.greendizer.resources.currentUICulture."+a)}catch(c){}try{return eval("greendizer.localization.defaultCulture."+a)||eval("greendizer.localization.defaultUICulture."+
a)}catch(d){}console.error(String.format("Could not find '{0}' in the current language and culture files.",a));return a};a.localization.defaultCulture={LongDateFormat:"MMMM dd, yy",ShortDateFormat:"MM/dd/yy",LongTimeFormat:"hh:mm:ss tt",ShortTimeFormat:"hh:mm t",LongFullDateFormat:"MMMM dd, yy hh:mm:ss tt",ShortFullDateFormat:"MM/dd/yy hh:mm t",LongAMDesignator:"AM",ShortAMDesignator:"A",LongPMDesignator:"PM",ShortPMDesignator:"P",DayNames:"sunday,monday,tuesday,wednesday,thursday,friday,saturday".split(","),AbbreviatedDayNames:"sun,mon,tue,wed,thu,fri,sat".split(","),MonthNames:"january,february,march,april,may,june,july,august,september,october,november,december".split(","),AbbreviatedMonthNames:"jan,feb,mar,apr,may,jun,jul,aug,sep,oct,nov,dec".split(",")};a.regexp={dateFormat:/d{1,4}|f{1,2}|h{1,2}|H{1,2}|m{1,2}|M{1,4}|L|s{1,2}|t{1,2}|y{1,2}|z{1,3}/g,emailFormat:/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i,compositeFormat:/\{(\d+)(\:[a-zA-Z_0-9]+)?\}/};a.types={buyers:{buyers:!0,settings:!0,emails:!0,invoices:!1,threads:!1,messages:!1,companies:!0,sellerhistories:!1,applications:!0,userevents:!0},sellers:{sellers:!0,settings:!0,emails:!0,invoices:!1,threads:!1,messages:!1,companies:!0,invoicereports:!1,applications:!0,userevents:!0}};a.base.domainRegExp=/^(http[s]?:\/\/[^/]+)\/?.*$/;a.base.extractDomain=function(b){if((b=a.base.domainRegExp.exec(b))&&1<b.length)return b[1]};a.base.parseQueryString=function(a){for(var a=a.split("&"),c={},d=0;d<a.length;d++)keyvalue=a[d].split("="),c[unescape(keyvalue[0])]=0<keyvalue.length?unescape(keyvalue[1]):null;return c};a.base.extractID=function(a){var c=a.indexOf("?");-1!==c&&(a=a.substr(0,c));a.lastIndexOf("/")===a.length-1&&(a=a.substr(0,a.length-1));return""+a.substr(a.lastIndexOf("/")+1)};a.base.hasProperties=function(a){if("object"===typeof a)return a.getCount()&&!0;throw new TypeError;};a.base.createGUID=function(){return a.base.hash.sha1((new Date).getTime()+
Math.round(1E3*Math.random())).toString()};a.base.Dictionary=function(a,c){a=a||{};c=c||!1;this.add=function(d,f){return!1===c&&!1===this.exists(d)?(a[d]=f,!0):!1};this.remove=function(d){return!1===c&&this.exists(d)?(delete a[d],!0):!1};this.get=function(d){return a[d]};this.exists=function(d){return!Object.isNullOrUndefined(a[d])};this.toObject=function(){return a}};a.base.FunctionCollection=function(a,c){var d={},f=0;this.add=function(c){c.getID()in d||(f++,a&&a());d[c.getID()]=c};this.remove=function(a){a.getID()in d&&(delete d[a.getID()],f--,c&&c())};this.fire=function(){for(var a in d)d[a].trigger.apply(this,arguments)};this.getCount=function(){return f}};a.base.FunctionPointer=function(b,c){var d=a.base.createGUID();this.getID=function(){return d};this.trigger=function(){b.apply(c||window,arguments)}};a.base.Timespan=function(a,c){var d=a.getTime()-c.getTime();this.getTotalDays=function(){return d/864E5};this.getTotalHours=function(){return d/36E5};this.getTotalMinutes=function(){return d/6E4};this.getTotalSeconds=function(){return d/1E3};this.getTotalMilliseconds=function(){return d};this.getDate=function(){return new Date(d)}};a.base.convert=new function(){this.rawStringToBase64=function(a){return B.b64(a)}};a.base.hash={sha1:function(){for(var a=[],c=0;c<arguments.length;c++)a.push(arguments[c]);return B.hex_sha1(""+a.join(""))},md5:function(){for(var a=[],c=0;c<arguments.length;c++)a.push(arguments[c]);return E.hex_md5(""+a.join(""))}};a.dal.Aggregator=function(b){var c=this,d=0,f=a.base.createGUID(),e={},g=[],h=[],i,l,n;this.changedEventWatchers=new a.base.FunctionCollection;this.addedEventWatchers=new a.base.FunctionCollection;this.removedEventWatchers=new a.base.FunctionCollection;this.getCount=function(){return d};this.getAvailableCount=function(){return g.length};this.getURI=function(){for(var a in e)return e[a].getURI();return null};this.getID=function(){return f};this.getType=function(){for(var a in e)return e[a].getType()};this.getContainer=function(){for(var a in e)return e[a].getContainer()};this.isLoading=function(){for(var a in e)if(e[a].isLoading())return!0;return!1};this.indexOf=function(a){return g.indexOf(a.getID())};this.itemAt=function(a){return h[g[a]]};var j=function(){d=0;for(var a in e)d+=e[a].getCount()},m=function(a){a.getID()in h||(h[a.getID()]=a,g.push(a.getID()),r(),c.addedEventWatchers.fire(a),c.changedEventWatchers.fire())},o=function(a,b){if(a.getID()in h){for(var d in e)if(e[d].getURI()!==b.getURI()&&e[d].findResource(a.getID()))return;c.removedEventWatchers.fire(a);delete h[a.getID()];g.splice($.inArray(a.getID(),g),1);c.changedEventWatchers.fire()}};this.getSortingFunction=function(){return b};var r=function(){b&&g.sort(function(a,d){return b(h[a.getID()],h[d.getID()])})};this.add=function(a){if(!this.exists(a)){if(this.getType()&&this.getType()!==a.getType())throw Error(String.format("Collections must handle the same type of resources ({0} vs {1}).",this.getType(),a.getType()));for(var b=a.getResources(),d=0;d<b.length;d++)m(b[d]);e[a.getURI()]=a;j();a.changedEventWatchers.add(n);a.addedEventWatchers.add(i);a.removedEventWatchers.add(l)}};this.remove=function(a){if(this.exists(a)){delete e[a.getURI()];for(var b=a.getResources(),d=0;d<b.length;d++)o(b[d],a);j();Collection.addedEventWatchers.remove(i);Collection.removedEventWatchers.remove(l)}};this.exists=function(a){return!Object.isNullOrUndefined(e[a.getURI()])};this.getResources=function(b,d){if(!g.length)return[];for(var b=b||0,d=d||Math.min(g.length,a.defaults.responseMaxSize),c=[],e=b;e<b+d&&e<g.length;e++)c.push(h[g[e]]);return c};this.findResource=function(a){for(var b in e){var d=e[b].findResource(a);if(d)return d}};this.loadNext=function(a,b){var d=Object.getCount(e),f=!1,g=null,h=[],i=function(e,i,j){d--;f=e||f;i&&(h=h.concat(j));if(!g||j&&g.getStatusCode()<j.getStatusCode())g=j;d||(c.changedEventWatchers.fire(),!f?a&&a(h):b&&b(j))},j;for(j in e)e[j].loadNext(function(a){i(!1,a)},function(a){i(!0,null,a)})};this.populate=function(a,b,d,f){var g=Object.getCount(e),h=!1,i=void 0,j=[],l=function(d,e,f){g--;h=d||h;e&&(j=j.concat(e));if(!i||f&&i.getStatusCode()<f.getStatusCode())i=f;g||(c.changedEventWatchers.fire(),!h?a&&a(j):b&&b(i))},n;for(n in e)e[n].populate(function(a){l(!1,a)},function(a){l(!0,null,a)},d,f)};this.refresh=function(a,b,d,f){var g=Object.getCount(e),h=!1,i=void 0,j=[],l=function(d,e,f){g--;h=d||h;e&&(j=j.concat(f));if(!i||f&&i.getStatusCode()<f.getStatusCode())i=f;g||(c.changedEventWatchers.fire(),h?a&&a(j):b&&b(f))},n;for(n in e)e[n].refresh(function(a){l(!1,a)},function(a){l(!0,null,a)},d,f)};this.loadInfo=function(a,b,d,f){var h=Object.getCount(e),g=!1,i=function(d){h--;g=d||g;h||(c.changedEventWatchers.fire(),!g?a&&a():b&&b())},j;for(j in e)e[j].loadInfo(function(){i(!1)},function(){i(!0)},d,f)};this.toString=function(){return String.format("<aggregator:{0}:{1}>",this.getType(),Object.getCount(e))};i=new a.base.FunctionPointer(m,c);l=new a.base.FunctionPointer(o,c);n=new a.base.FunctionPointer(j,c)};a.dal.Collection=function(b,c,d){var f=this,e=[];c&&e.push(c);d&&e.push(d);var g=a.dal.Filter.parse(e.join("|")),h=b.getURI()+(c?"?q="+escape(c):String.EMPTY),i=a.base.createGUID(),l=new Date(0),n=new a.http.Etag(l,"0"),j=[],m={},o=null,r={},q=0,s,t=!1,u=0,y=new Date(0);this.changedEventWatchers=new a.base.FunctionCollection;this.addedEventWatchers=new a.base.FunctionCollection;this.removedEventWatchers=new a.base.FunctionCollection;this.getContainer=function(){return b.getContainer()};this.getType=function(){return b.getType()};this.getURI=function(){return h};this.getID=function(){return i};this.getFilter=function(){return g};this.getCount=function(){return!o?j.length:Math.max(0,o.getTotal()+u-q)};this.getAvailableCount=function(){return j.length};this.getSortingFunction=function(){};this.isLoading=function(){return t};var p=function(b,d){var c=b.getID();m[c]||(m[c]=b,j.push(c),j.sort(z),(d===a.dal.dataSourceEnum.MEMORY||!t&&l<b.getLastModified())&&u++,f.changedEventWatchers.fire(),f.addedEventWatchers.fire(m[c]))},w=function(b,d){var c=b.getID();m[c]?(d===a.dal.dataSourceEnum.MEMORY?(r[c]=c,q++):!t&&l<b.getLastModified()&&u--,j.splice($.inArray(c,j),1),f.changedEventWatchers.fire(),f.removedEventWatchers.fire(m[c],f),delete m[c]):d===a.dal.dataSourceEnum.SERVER&&c in r&&(delete r[c],q--,!t&&l<b.getLastModified()&&u--)},z=function(){},x=function(b,d){if(b.getState()===a.dal.resourceStateEnum.DELETED)return w(b,d);f.testResource(b,function(a){a?p(b,d):w(b,d)})},C=function(a,b){w(a,b)},D=function(d,c,e){u=0;o=d.getContentRange();l=d.getLastModified();p=d.getEtag();if(c)return f.changedEventWatchers.fire(),e&&e();var g=d.getData();if(g&&!g.length)return e&&e([]);for(var h=[],i=g.length,j=function(b,d){i--;d.sync(b,a.dal.dataSourceEnum.SERVER);h.push(d);if(!i)return f.changedEventWatchers.fire(),e&&e(h)},n=0;n<g.length;n++){var p=a.http.Etag.parse(g[n][a.dal.resourceColumnEnum.ETAG]);b.getContainer().findResource(f.getType(),function(a){j(g[n],a,p)},function(){var a=b.getInstantiator()(b.getContainer(),p.getID());if(!a||a.getType()!==f.getType())throw Error("Instantiator did not return a valid instance.");j(g[n],a,p)},b.getInstantiator(),!0)}},A=function(d,c,e,g,i,p){t&&s.abort();i=i||!1;p={origin:a.http.requestOriginEnum.COLLECTION,type:f.getType(),entity:f,description:p||"Collections.Download"};s=new a.http.Request(b.getContainer().getClient(),i?a.http.httpMethodsEnum.HEAD:a.http.httpMethodsEnum.GET,h,p);if(!isNaN(e)&&!isNaN(g)){g=Math.min(a.defaults.responseMaxSize,g);s.addHeader("Range",(new a.http.Range(f.getType(),e,Math.max(0,Number(e)+Number(g)-1))).toString());n.toString()!==a.http.Etag.NONE&&s.addHeader("If-Range",n.toString());for(var w=f.getResources(e,g),r=[],p=0;p<w.length;p++)r.push(w[p].getEtag().toString());0<w.length&&s.addHeader("If-None-Match",r.join(";"))}else if(0<l)s.addHeader("If-Modified-Since",l.toString("%ISO8601"));else{w=[];for(p=0;p<j.length&&p<a.defaults.responseMaxSize;p++)w.push(m[j[p]].getEtag().toString());w.length&&s.addHeader("If-None-Match",w.join(";"))}t=!0;s.getResponse(function(b){y=new Date;switch(b.getStatusCode()){case a.http.statusCodesEnum.NOT_MODIFIED:var h=i,p=g;u=0;l=b.getLastModified();n=b.getEtag();d&&d(h?void 0:f.getResources(e,p));break;case a.http.statusCodesEnum.OK:case a.http.statusCodesEnum.PARTIAL:D(b,i,d);break;case a.http.statusCodesEnum.NO_CONTENT:u=0;l=b.getLastModified();n=b.getEtag();o=null;j=[];m={};f.changedEventWatchers.fire();d&&d([]);break;case a.http.statusCodesEnum.REQUEST_RANGE_NOT_SATISFIABLE:d&&d([]);break;default:c&&c(b)}t=!1})};this.loadNext=function(a,b){this.load(a,b,j.length,1)};this.populate=function(a,b,d,c,e){A(a,b,d,c,!1,e)};this.refresh=function(a,b,d,c,e){3E4>Date.now()-y?a&&a(this.getResources(d,c)):A(a,b,d,c,!1,e)};this.loadInfo=function(a,b,d,c,e){A(a,b,d||0,c||1,!0,e)};this.init=function(b){if(0===this.getContainer().getCount())b&&b(this);else{var d=this.getContainer().getResources(),c=this.getContainer().getCount(),e=function(){c--;!c&&b&&b(this)},g;for(g in d)with({k:g})f.testResource(d[k],function(b){b&&p(d[k],a.dal.dataSourceEnum.MEMORY);e()})}};this.getResources=function(b,d){if(!j.length)return[];for(var b=b||0,d=d||Math.min(j.length,a.defaults.responseMaxSize),c=[],e=b;e<b+d&&e<j.length;e++)c.push(m[j[e]]);return c};this.testResource=function(a,b){return g?g.test(a,function(a){b&&b(a)}):b&&b(!0)};this.findResource=function(a){return m[a]};this.indexOf=function(a){return j.indexOf(a.getID())};this.itemAt=function(a){return m[j[a]]};this.toString=function(a){switch(a){case"type":return this.getType();default:return String.format("<collection:{0}:{1}>",this.getType(),this.getURI())}};(function(){var d=b.getContainer();d.addedResourceEventWatchers.add(new a.base.FunctionPointer(x,f));d.removedResourceEventWatchers.add(new a.base.FunctionPointer(C))})()};a.dal.Container=function(b,c){var d=this,f={},e=0,g={},h={},i;this.changedResourceEventWatchers=new a.base.FunctionCollection;this.addedResourceEventWatchers=new a.base.FunctionCollection;this.removedResourceEventWatchers=new a.base.FunctionCollection;this.getClient=function(){return b};this.getType=function(){return c};this.getResources=function(){return g};this.getCount=function(){return e};this.watch=function(a){f[a.getID()]=f[a.getID()]||a;a.changedEventWatchers.add(i)};var l=function(a,b,c,e){var g=f[a]||e(d,a);if(!g)throw Error("Instantiator did not return a valid value.");g.load(function(){b&&b(g)},function(){c&&c()})},n=function(a,b,d){d()&&d()},j=function(e,g){if(b.getOption("cache")&&a.types[b.getType()][c]){var h=a.dal.Resource.generateKey(d,e);if(h=b.getOption("storageEngine").getItem(h)){var i=f[e]||g(d,e);i.sync(JSON.parse(h),a.dal.dataSourceEnum.DATABASE);i.load();return i}}},m=function(a,b){if(h[a]){var d=[],c;for(c in h[a])d.push(h[a][c][b?"successFn":"failureFn"]);delete h[a];for(var e in d)d[e](b)}};this.findResource=function(a,b,c,e,i){a=""+(a||0);i=i||!1;if(!b&&!c)return g[a]||f[a]||e(d,a);if(g[a])return b(g[a]),m(a,g[a]),g[a];var u=j(a,e);if(u)return b(u),m(a,u),u;if(h[a])return h[a].push({successFn:b,failureFn:c});h[a]=[];n([a],function(d){b(d[0]);m(a,d[0])},function(){i?(c&&c(),m(a)):l(a,function(d){b(d);m(a,d)},function(){c&&c();m(a)},e)},e)};this.exists=function(a){return g[a]&&!0};this.init=function(a){a&&a()};this.empty=function(){if(b.getOption("cache")){for(var c in g)b.getOption("storageEngine").removeItem(a.dal.Resource.generateKey(d,c));g={}}};i=new a.base.FunctionPointer(function(b,h){delete f[b.getID()];b.getState()===a.dal.resourceStateEnum.DELETED?(b.changedEventWatchers.remove(i),d.exists(b.getID())&&(d.removedResourceRemovedEventWatchers.fire(b,h),e--,delete g[b.getID()])):!d.exists(b.getID())&&b.getType()===c&&(e++,g[b.getID()]=b,d.addedResourceEventWatchers.fire(b,h));d.changedResourceEventWatchers.fire(b,h)},d)};a.dal.Criterion=function(b,c,d){this.getProperty=function(){return b};this.getOperator=function(){return c};this.getTarget=function(){return d};this.isExclusive=function(){return!0};this.test=function(a,g){var h=a.getPropertyValue(b),i=d.split("+");if(a.hasCustomTest(b))return a.performCustomTest(b,i,g);for(var l=!1,n=0;n<i.length;n++){l=f(i[n]);switch(c){case"==":switch(typeof l){case"number":l=a.allowsApproximation(b)?h>=0.95*l&&h<=1.05*l:Number(h)===l;break;case"string":l=h.toString().contains(l);break;case"boolean":l=h===l;break;default:l=h&&!0}break;case">>":l=h>l;break;case"<<":l=h<l;break;case">=":l=h>=l;break;case"<=":l=h<=l;break;case"!=":l=h!=l;break;default:throw Error("Unknown Operator: "+c);}!l&&g(!1)}return g(!0)};this.getSQLOperator=function(){return"=="===c?isNaN(Number(d))?"null"===d?" IS NULL":" LIKE ?":" BETWEEN ? AND ?":"!="===c&&"null"===d?" NOT NULL":c+"?"};var f=function(a){if(!isNaN(Number(a)))return Number(a);a=a.toString();return"true"===a.toLowerCase()?!0:"false"===a.toLowerCase()?!1:a};this.toSQL=function(b){for(var g=d.toString().split("+"),h=[],i=[],l=[],n=[],j=0;j<g.length;j++){var m=String.EMPTY;Object.isNullOrUndefined(a.models.buyers.dal.search[b])||Object.isNullOrUndefined(a.models.buyers.dal.search[b][m])?m=b+"."+m:(m=a.models.buyers.dal.search[b][m].property,l=a.models.buyers.dal.search[b][m].Join,n=a.models.buyers.dal.search[b][m].On);i.push(String.format("{0}{1}",m,this.getSQLOperator()));m=f(Items[j]);Object.isNullOrUndefined(m)||(isNaN(m)?h.push(m):"=="===c?(h.push(0.95*m),h.push(1.05*m)):h.push(m))}return{parameters:i.join(" OR "),value:h,joins:l,jointures:n}};this.toString=function(){var a=f(d);return String.format("{0}{1}{2}",b,c,a)}};a.dal.CriterionGroup=function(a,c){var a=a||!1,c=c||!1,d=[];this.getCriteria=function(){return d};this.isExclusive=function(){return!c};this.getSQLOnly=function(){return a||!1};this.toSQL=function(a){var b=[],g=[],h=[],i=[],l;for(l in d){var n=d[l].toSQL(a),h=h.concat(n.parameters),b=b.concat(n.values),j;for(j in n.joins)-1==$.inArray(n.joins[j],g)&&(g.push(n.joins[j]),i.push(n.jointures[j]))}return{values:b,joins:g,parameters:h.join(c?" OR ":" AND "),jointures:i}}};a.dal.CustomProperty=function(a,c,d,f){this.getName=function(){return a};this.getRelatedProperty=function(){return c};this.get=function(){return d.apply(this)};this.set=function(){return f.apply(this,arguments)}};a.dal.Filter=function(a){a=a||[];this.getGroups=function(){return a};this.test=function(d,f){var e=a.length,g=!1,h=function(a){e--;g=!a||g;!e&&f(!g)},i;for(i in a)a[i].getSQLOnly()?h(!0):c(a[i],d,h)};var c=function(a,b,c){for(var g=a.getCriteria().length,h=!1,i=function(b){0>g||(g--,!b&&a.isExclusive()?(g=-1,c&&c(!1)):(h+=b,!g&&c(0<h)))},l=0;l<a.getCriteria().length;l++)a.getCriteria()[l].test(b,i)};this.toURIString=function(){return escape(this.toString())};this.toSQLite=function(d,c,e,g){for(var h=[],i=[],l=[],n=[],j=0;j<a.length;j++){var m=a[j].toSQL(d),o;for(o in m.joins)-1==$.inArray(m.joins[o],h)&&(h.push(m.joins[o]),n.push(m.jointures[o]));i=i.concat(m.parameters);l=l.concat(m.values)}j=String.EMPTY;j=h.length?String.format("SELECT {0}.* FROM {0} WHERE ({1})",d,i.join(") AND (")):String.format("SELECT {0}.* FROM {0} JOIN {1} ON {2} WHERE ({3})",d,h.join(","),n.join(","),i.join(") AND ("));e&&(j+=String.format("ORDER BY {0}",e));g&&(j+=String.format("LIMIT {0}",g));c&&(j+=String.format("OFFSET {0}",c));return{query:j,values:l}};this.toString=function(){for(var d=String.EMPTY,c=0;c<a.length;c++){0<c&&(d+="&");for(var e=0;e<a[c].getCriteria().length;e++)0<e&&(d+="|"),d+=a[c].getCriteria()[e].toString()}return d}};a.dal.Filter.parse=function(b){if(b){var c=[],d=new a.dal.CriterionGroup(!1);c.push(d);for(var b=b.split(/&|[|]{1}/),f=0;f<b.length;f++)for(var e=/[><]{1,2}|[><!=]{1}={1}/g,g=null;null!==(g=e.exec(b[f]));){var g=g.toString(),h=b[f].substr(0,e.lastIndex-g.length),i=b[f].substr(e.lastIndex);d.getCriteria().push(new a.dal.Criterion(h,g,i))}return new a.dal.Filter(c)}};a.dal.Node=function(b,c,d){var f={};this.search=function(b,d,c){if(Object.isNullOrUndefined(b))throw Error("Query can't be null/undefined");var i=b;i||(i="__ALL__",b=null);if(i in f)return f[i];f[i]=new a.dal.Collection(this,b,c);f[i].init(d);return f[i]};this.getItemByID=function(a,c,f){return b.findResource(a,c,f,d)};this.getInstantiator=function(){return d};this.getAll=function(a){return this.search("",a)};this.getType=function(){return b.getType()};this.getContainer=function(){return b};this.getURI=function(){return c};this.getCollections=function(){return f}};a.dal.Resource=function(b,c){var d=this,f,e={},g={},h=new Date(0),i=void 0,l=void 0,n={},j=a.dal.resourceStateEnum.None,m,o,r=[],q=!1;this.syncedEventWatchers=new a.base.FunctionCollection;this.changedEventWatchers=new a.base.FunctionCollection;this.getContainerByType=function(a){return b.getClient().getContainerByType(a)};this.getURI=function(){throw Error("getURI method has not been defined for this resource.");};this.getDefaultFields=function(){return[]};this.getID=function(){return c||0};this.getEtag=function(){return new a.http.Etag(this.getLastModified(),c||"0")};this.getCreatedDate=function(){return new Date(this.getPropertyValue("createdDate"))};this.getLastModified=function(){return h};this.getType=function(){return b.getType()};this.getContainer=function(){return b};this.getState=function(){return j};this.getData=function(){return{}};var s=function(a,b){if(n[a])return e[n[a].getParentProperty()]!==b?(e[n[a].getParentProperty()]=n[a].set.call(d,b),!0):!1;return e[a]!==b?(e[a]=b,!0):!1},t=function(b){if(q)return r.push(b);q=!0;o=o||new a.dal.ResourceHistory(d);o.add(b.entry);var c=b.entry.getRequest();c.addHeader("If-Match",d.getEtag().toString());c.getResponse(function(e){u(c.getData(),e,b.successFn,function(){d.sync(b.entry.getBackup(),a.dal.dataSourceEnum.MEMORY);"failureFn"in b&&b.failureFn.apply(d,arguments)});q=!1;r.length&&t(r.splice(0,1)[0])})},u=function(b,c,e,f){if(c.getStatusCode()!==a.http.statusCodesEnum.NO_CONTENT)return f&&f(c);b[a.dal.resourceColumnEnum.ETAG]=c.getEtag().toString();d.sync(b,a.dal.dataSourceEnum.SERVER);e&&e(c)};this.update=function(c,e){if(i){d.sync(i,a.dal.dataSourceEnum.MEMORY);var f=[],g;for(g in l)f.push(l[g]);f={origin:a.http.requestOriginEnum.RESOURCE,type:this.getType(),entity:this,description:f||"Resources.Update"};f=new a.http.Request(b.getClient(),a.http.httpMethodsEnum.PATCH,this.getURI(),f);f.setData(i);t({entry:new a.dal.ResourceHistoryEntry(f,m),successFn:c,failureFn:e});d.clearPendingUpdates()}else c&&c()};var y=function(a){if(!a)return d.getDefaultFields();for(var b=d.getDefaultFields(),c=0;c<a.length;c++){var e=$.inArray(a[c],b);-1!==e&&b.splice(e,1);e=$.inArray("-"+a[c],b);-1!==e&&b.splice(e,1)}return $.unique(b.concat(a))};this.load=function(c,e,f,g){var f=y(f),i=this.getURI();0<f.length&&(i=String.format("{0}?fields={1}",URI,f.join(",")));g={origin:a.http.requestOriginEnum.RESOURCE,type:d.getType(),entity:d,description:g||"Resources.Download"};i=new a.http.Request(b.getClient(),a.http.httpMethodsEnum.GET,i,g);d.hasFields(f)&&0<h.getTime()&&(i.addHeader("If-None-Match",d.getEtag().toString()),i.addHeader("If-Modified-Since",h.toString("%ISO8601")));i.getResponse(function(b){if(b.getStatusCode()===a.http.statusCodesEnum.OK){var f=b.getData();f[a.dal.resourceColumnEnum.ETAG]=b.getEtag().toString();d.sync(f,a.dal.dataSourceEnum.SERVER);c&&c(b)}else b.getStatusCode()===a.http.statusCodesEnum.NOT_MODIFIED?c&&c(b):e&&e(b)})};this.loadInfo=function(c,e){var f={origin:a.http.requestOriginEnum.RESOURCE,type:d.getType(),entity:d,description:e||"Resources.Download"},f=new a.http.Request(b.getClient(),a.http.httpMethodsEnum.HEAD,this.getURI(),f);0<h.getTime()&&(f.addHeader("If-None-Match",d.getEtag().toString()),f.addHeader("If-Modified-Since",h.toString("%ISO8601")));f.getResponse(c)};this.remove=function(c,e,f){c={origin:a.http.requestOriginEnum.RESOURCE,type:this.getType(),entity:this,description:f||"Resources.Delete"};(new a.http.Request(b.getClient(),a.http.httpMethodsEnum.DELETE,this.getURI(),c)).getResponse(function(b){b.getStatusCode()!==a.http.statusCodesEnum.NO_CONTENT&&e&&e(b);j=a.dal.resourceStateEnum.DELETED;d.ChangedEventWatchers.fire(d,a.dal.dataSourceEnum.SERVER)})};this.hasCustomTest=function(a){return g[a]&&!0};this.allowsApproximation=function(){return!1};this.performCustomTest=function(a,b,c){return!g[a]?void 0:g[a].call(this,b||[],c)};this.registerCustomTest=function(a,b){g[a]=b};this.registerProperty=function(a){n[a.getName()]=a};this.getPropertyValue=function(a){if(!Object.isNullOrUndefined(e[a]))return e[a];if(n[a])return n[a].get.apply(this)};this.sync=function(d,e,g){if(d){var i=new Date;if(e===a.dal.dataSourceEnum.DATABASE)i.setTime(d[a.dal.resourceColumnEnum.LAST_MODIFIED]);else if(e===a.dal.dataSourceEnum.SERVER){var l=a.http.Etag.parse(d[a.dal.resourceColumnEnum.ETAG]),i=l.getLastModified();c=l.getID()}else i=h;l=[];for(field in d)l.push(field);if(!this.hasFields(l)||!(i<=h&&e!==a.dal.dataSourceEnum.MEMORY)){h=i;switch(e){case a.dal.dataSourceEnum.SERVER:j=a.dal.resourceStateEnum.NONE;delete d[a.dal.resourceColumnEnum.ETAG];break;case a.dal.dataSourceEnum.MEMORY:j=!Object.isNullOrUndefined(m)&&j!==a.dal.resourceStateEnum.DELETED?a.dal.resourceStateEnum.UPDATED:j;break;case a.dal.dataSourceEnum.DATABASE:databased=!0,j=d[a.dal.resourceColumnEnum.STATE],m=Object.isNullOrUndefined(d[a.dal.resourceColumnEnum.BACKUP])?null:JSON.parse(d[a.dal.resourceColumnEnum.BACKUP]),c=d[a.dal.resourceColumnEnum.ID],delete d[a.dal.resourceColumnEnum.ID],delete d[a.dal.resourceColumnEnum.STATE],delete d[a.dal.resourceColumnEnum.BACKUP],delete d[a.dal.resourceColumnEnum.LAST_MODIFIED]}var i=!1,n;for(n in d)i=s(n,d[n])||i;i?(e!==a.dal.dataSourceEnum.DATABASE&&b.getClient().getOption("cache")&&a.types[b.getClient().getType()][this.getType()]&&b.getClient().getOption("storageEngine").setItem(f,JSON.stringify(this.objectify())),this.syncedEventWatchers.fire(d,e),this.changedEventWatchers.fire(this,e)):e===a.dal.dataSourceEnum.SERVER&&this.changedEventWatchers.fire(this,e)}}g&&g(this)};this.registerUpdate=function(b,d,e){if(Object.isNullOrUndefined(c))throw Error("Resource must first be created before it can be updated.");if(Object.isNullOrUndefined(d))throw Error("value is null or undefined.");d instanceof Date&&(d=d.getTime());if(this.getPropertyValue(b)!==d){var f=m?m[b]:void 0,g=this.getPropertyValue(b);g?(m=m||{},m[b]=g):f===d&&(delete m[b],m=!a.base.hasProperties(m)?null:m,j=j===a.dal.resourceStateEnum.UPDATED&&!m?a.dal.resourceStateEnum.NONE:j);i=i||{};i[b]=d;l=l||{};l[b]=e||"Resources.Update"}};this.clearPendingUpdates=function(){l=i=void 0;m=null;j=j===a.dal.resourceStateEnum.UPDATED?a.dal.resourceStateEnum.NONE:j};this.hasFields=function(a){for(var a=a||[],b=0;b<a.length;b++)if(Object.isNullOrUndefined(this.getPropertyValue(a[b])))return!1;return!0};this.toString=function(a){switch((a||String.EMPTY).toLowerCase()){case"id":return this.getID();case"uri":return this.getURI();case"etag":return this.getEtag().toString()}return String.format("<{0}:{1}>",this.getType(),this.getURI())};this.objectify=function(){var b={};$.extend(b,e);b[a.dal.resourceColumnEnum.ID]=c;b[a.dal.resourceColumnEnum.BACKUP]=m;b[a.dal.resourceColumnEnum.LAST_MODIFIED]=h.getTime();b[a.dal.resourceColumnEnum.STATE]=j;return b};f=a.dal.Resource.generateKey(b,d.getID());b.watch(d)};a.dal.Resource.generateKey=function(a,c){return String.format("{0}{1}",a.getType(),c||"0").toSHA1()};a.dal.ResourceHistory=function(a){var c={},d=[];this.getResource=function(){return a};this.add=function(a){if(!this.exists(a)){var b=a.getRequest().getID();c[b]=a;d.push(b)}};this.exists=function(a){return a.getRequest().getID()in c};this.getCount=function(){return d.length}};a.dal.ResourceHistoryEntry=function(a,c){this.getRequest=function(){return a};this.getPushedData=function(){return a.getData()};this.getBackup=function(){return c}};a.dal.dataSourceEnum={SERVER:"server",DATABASE:"database",MEMORY:"memory"};a.dal.dataTypeEnum={EMAILS:"emails",SETTINGS:"settings",APPLICATIONS:"applications",INVOICES:"invoices",THREADS:"threads",MESSAGES:"messages",BUYERS:"buyers",SELLERS:"sellers",SELLERHISTORIES:"sellerhistories",COMPANIES:"companies",INVOICEREPORTS:"invoicereports",ADMINISTRATORS:"administrators",USEREVENTS:"userevents"};a.dal.resourceColumnEnum={ID:"id",STATE:"state",BACKUP:"backup",LAST_MODIFIED:"lastModified",ETAG:"etag"};a.dal.resourceStateEnum={NONE:0,UPDATED:1,DELETED:2};a.http.ContentRange=function(a,c,d,f){a=a||"resources";c=c||0;d=d||0;this.toString=function(){return String.format("{0}={1}-{2}",a,c,d)};this.getUnit=function(){return a};this.getFirst=function(){return c};this.getLast=function(){return d};this.getTotal=function(){return f}};a.http.ContentRange.parse=function(b){if(!b)return null;b=/^(\w+)(?:[= ])?(\d+)-(\d+)\/(\d+)$/i.exec(b);return!b?null:new a.http.ContentRange(b[1],Number(b[2]),Number(b[3]),Number(b[4]))};a.http.Etag=function(a,c){this.getLastModified=function(){return a};this.getID=function(){return c};this.toString=function(){return"0"==""+c||0>=a.getTime()?"*":String.format("{0}-{1}",Math.max(0,a.getTime()),c)}};a.http.Etag.parse=function(b){if(!b)return null;b=(""+b).split("-");return new a.http.Etag(new Date(Number(b[0])),b[1])};a.http.Etag.NONE="*";a.http.QueuedRequest=function(b,c){var d=this;this.completedWatchers=new a.base.FunctionCollection;this.getID=function(){return b.getID()};this.getRequest=function(){return b};this.getCallbackFn=function(){return c};this.retry=function(a){b.getResponse(function(b){c(b);a&&a(b)},a)};b.completedEventWatchers.add(new a.base.FunctionPointer(function(a,b){d.completedWatchers.fire(d,b)},d))};a.http.Range=function(a,c,d){a=a||"";c=c||0;d=d||0;this.toString=function(){return String.format("{0}={1}-{2}",a,c,d)};this.getUnit=function(){return a};this.getFirst=function(){return c};this.getLast=function(){return d};this.getTotal=function(){return d-c};this.setUnit=function(d){a=d};this.setFirst=function(a){c=a};this.setLast=function(a){d=a}};a.http.Request=function(b,c,d,f,e){var e=e||!1,g,h={},i=this,l=a.base.createGUID(),n=null,j,m;this.completedEventWatchers=new a.base.FunctionCollection;var o;this.setCredentials=function(a,b){j=a;m=b};this.getID=function(){return l};this.getDate=function(){return n};this.addHeader=function(a,b){h[a.capitalize()]=b};this.removeHeader=function(a){delete h[a.capitalize()]};this.clearHeaders=function(){h={}};this.getHeader=function(a){return h[a.capitalize()]};this.abort=function(){Object.isNullOrUndefined(o)||o.abort()};this.getResponse=function(e,f){var l=c===a.http.httpMethodsEnum.HEAD||c===a.http.httpMethodsEnum.GET;-1===$.inArray(c,a.http.NativeHttpMethods)&&(h["X-HTTP-Method-Override"]=c);b.signRequest&&!1===b.signRequest(i)||(n=new Date,o=b.getTunnel().ajax({timeout:45E3,type:-1<$.inArray(c,a.http.NativeHttpMethods)?c:a.http.httpMethodsEnum.POST,cache:l,dataType:"json",contentType:l?null:"application/x-www-form-urlencoded",url:d,headers:h,username:j,password:m,data:g&&!l?g:null,success:function(b,d,c){b=new a.http.Response(c,i,b);i.completedEventWatchers.fire(i,b);e&&e(b)},error:function(d,c){if(b.getOption("timeouts")&&("timeout"===c||500<=d.status)){if(f){f(new a.http.Response(d,i));return}b.getTimeoutRequestQueue().add(i,e,d)}if(d.status===a.http.statusCodesEnum.BAD_REQUEST||d.status==a.http.statusCodesEnum.INTERNAL_ERROR)try{console.error(String.format("(Greendizer Error {0}) {1}",d.status,JSON.parse(d.responseText).desc))}catch(g){console.log(d.responseText||"Greendizer: unexpected error.")}var h=new a.http.Response(d,i);i.completedEventWatchers.fire(i,h,e);e&&e(h)}}))};this.isInternal=function(){return e};this.getMethod=function(){return c};this.getMetadata=function(){return f};this.getURI=function(){return d};this.getData=function(){return g};this.setMethod=function(){Method=value};this.setURI=function(){d=value};this.setData=function(a){g=a};c!==a.http.httpMethodsEnum.HEAD&&c!==a.http.httpMethodsEnum.GET&&(d=a.http.Request.removeQueryString(d));d=a.http.Request.appendSlash(d)};a.http.Request.appendSlash=function(a){return"/"!==a.charAt(a.length-1)&&-1===a.indexOf("?")?a+"/":a};a.http.Request.removeQueryString=function(a){var c=a.indexOf("?");return-1===c?a:a.substr(0,c)};a.http.RequestQueue=function(){var b={},c;this.addedRequestWatchers=new a.base.FunctionCollection;this.removedRequestWatchers=new a.base.FunctionCollection;this.getRequests=function(){var a=[],c;for(c in b)a.push(b[c]);return a};this.getCount=function(){return Object.getCount(b)};this.add=function(d,f,e){b[d.getID()]||(b[d.getID()]=new a.http.QueuedRequest(d,f,e),d.completedEventWatchers.add(c),this.addedRequestWatchers.fire(d))};this.empty=function(d){if(d)for(var c in b)b[c].getCallbackFn(new a.http.Response(!1,b[c].XHR,b[c].Request));b={}};this.process=function(a){var c=this.getCount(),e=function(){c--;!c&&a&&a()},g;for(g in b)b[g].retry(e)};c=new a.base.FunctionPointer(function(a,f){delete b[a.getID()];this.removedRequestWatchers.fire(a,f);a.completedEventWatchers.remove(c)},this)};a.http.Response=function(b,c,d){this.getRequest=function(){return c};this.getData=function(){return d};this.getDate=function(){return new Date(b.getResponseHeader("Date"))};this.getStatusCode=function(){return b.status};this.getLocation=function(){return b.getResponseHeader("Location")};this.getLastModified=function(){return Date.parseISO8601(b.getResponseHeader("Last-Modified"))};this.getEtag=function(){return $.browser.msie&&1223===b.status?new a.http.Etag((new Date).getTime(),"0"):a.http.Etag.parse(b.getResponseHeader("Etag"))};this.getContentRange=function(){return a.http.ContentRange.parse(b.getResponseHeader("Content-Range"))};this.getResponseHeader=function(a){return b.getResponseHeader(a)};this.getXHR=function(){return b}};a.http.httpMethodsEnum={HEAD:"HEAD",GET:"GET",PATCH:"PATCH",POST:"POST",PUT:"PUT",DELETE:"DELETE",OPTIONS:"OPTIONS"};a.http.NativeHttpMethods=[a.http.httpMethodsEnum.HEAD,a.http.httpMethodsEnum.GET,a.http.httpMethodsEnum.POST,a.http.httpMethodsEnum.PUT,a.http.httpMethodsEnum.DELETE,a.http.httpMethodsEnum.OPTIONS];a.http.requestOriginEnum={RESOURCE:"resource",COLLECTION:"collection",AGGREGATOR:"aggregator",OTHER:"other"};a.http.statusCodesEnum={OK:200,CREATED:201,ACCEPTED:203,NO_CONTENT:204,PARTIAL:206,MULTI_STATUS:207,FOUND:302,NOT_MODIFIED:304,BAD_REQUEST:400,NOT_AUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,CONFLICT:409,PRECONDITION_FAILED:412,REQUEST_RANGE_NOT_SATISFIABLE:416,INTERNAL_ERROR:500};a.oauth.BuyerApplication=function(b,c){var d=this;(function(){if("oAuthToken"in b){var e=["buyers",b.oAuthToken,"BEARER",b.userId,c];a.oauth.TokenClient.apply(d,e)}else e=["buyers",b.oAuthClientId,b.oAuthRedirectUri,b.oAuthScopes,c],a.oauth.Client.apply(d,e)})();var f=this.getUser;this.getUser=function(b,d){return f.call(this,b,d,function(b,d){return new a.resources.buyers.Buyer(b,d)})};this.getBuyer=function(){return this.getUser()}};(function(){var b=a.base.parseQueryString(window.location.hash.substr(1));if("error"in b||"oauth_token"in b&&"state"in b&&"channel"===b.state)window.stop?window.stop():document.execCommand("Stop"),document.write("")})();a.oauth.Client=function(b,c,d,f,e){if(!b||1>(""+b).length)throw Error("oAuthContext is invalid or missing");if(!c||1>(""+c).length)throw Error("oAuthClientId is invalid or missing");if(!f||1>(""+f).length)throw Error("oAuthScope is invalid or missing");var g=this,h=String.format("gd_oauth_{0}_{1}",b,c),i,l,n,j,m,o;a.Client.call(this,b,e);var r=this.init,q=this.reset;this.getID=function(){return c};this.getTunnel=function(){return i};this.getContext=function(){return b};this.getGrantedScope=function(){return n};this.getUserID=function(){return m};this.isAuthenticated=function(){return!Object.isNullOrUndefined(l)};this.signRequest=function(a){if(!j||!l)return!1;a.completedEventWatchers.add(o);a.addHeader("Authorization",String.format("{0} {1}",j.toUpperCase(),l))};this.init=function(b,d){autologin=this.getOption("autologin")||d||!1;i=new a.Tunnel.getInstance;r.call(g,function(){i.init(function(){autologin?g.authenticate(b,!d):b&&b(!1)})})};var s=function(a,b){if(g.getOption("storageEngine")&&window.JSON){if(void 0===b)return JSON.parse(g.getOption("storageEngine").getItem(a));if(null===b)return g.getOption("storageEngine").removeItem(a);g.getOption("storageEngine").setItem(a,JSON.stringify(b))}},t=function(a){m&&m!==a.user_id&&g.reset();l=a.oauth_token;n=a.scope.split(" ");j=a.token_type;m=a.user_id;"refresh_token"in a&&delete a.refresh_token;"state"in a&&delete a.state;s(h,a)};this.authenticate=function(e,i,o,r){var i=!1!==i,q;if(!o&&this.getOption("cache")&&(q=s(h))){t(q);this.getUser().loadInfo(function(a){403!==a.getStatusCode()||401!==a.getStatusCode()?($(window).trigger("greendizer.authenticated",!0),e&&e(!0)):g.authenticate(e,i,!0,r)});return}q=a.base.parseQueryString(window.location.hash.substr(1));if("oauth_token"in q)document.location.hash="",t(q),$(window).trigger("greendizer.authenticated",!0),e&&e(!0);else if("reboot"in q)document.location.hash="",g.authenticate(e,i,o,r);else if("error"in q)document.location.hash="",l=n=m=null,e&&e(!1,q.error),s(h,null);else if(r)e&&e(!1,"");else{var x=document.createElement("iframe");x.style.display="none";x.onload=function(){try{var d=a.base.parseQueryString(x.contentWindow.location.hash.substr(1));document.body.removeChild(x)}catch(g){console&&console.error("Greendizer - Authentication service is not available.");e&&e(!1);return}if("oauth_token"in d)t(d),e&&e(!0);else{if(!i&&"unauthorized_client"===d.error)window.location.href=a.oauth.Client.generateAuthorizeUri(b,c,document.location.href,f,!1);l=n=j=m=null;s(h,null);e&&e(!1,d.error)}};x.src=a.oauth.Client.generateAuthorizeUri(b,c,d,f,!0,"channel");document.body.appendChild(x)}};this.reset=function(){q.call(this);l=n=m=j=null;s(h,null)};o=new a.base.FunctionPointer(function(b,d,c){d=d.getXHR();if((d.status===a.http.statusCodesEnum.NOT_AUTHORIZED||d.status===a.http.statusCodesEnum.FORBIDDEN)&&g.getOption("autologin")){var e=g.getUnauthorizedRequestQueue();e.add(b,c,d);if(1===e.getCount()){if(d.status===a.http.statusCodesEnum.FORBIDDEN&&(console.warn("Token has expired or user has logged out."),b=$.Event("greendizer.authenticated",!1),$(window).trigger(b),!g.getOption("protected")||b.isDefaultPrevented())){e.empty(!0);g.reset();return}g.authenticate(function(a){a?e.process():(e.empty(!0),g.reset())},d.status!==a.http.statusCodesEnum.FORBIDDEN,!0)}}},g)};a.oauth.Client.generateAuthorizeUri=function(b,c,d,f,e,g){d=(d||document.location.href).split("#")[0];return String.format("{0}{1}/authorize/?client_id={2}&redirect_uri={3}&response_type=token&scope={4}&immediate={5}{6}",a.EndPoints.OAUTH_SERVICE,b,c,escape(d),escape(f),(e||!1).toString(),g?String.format("&state={0}",escape(g)):String.EMPTY)};a.oauth.SellerApplication=function(b,c){"oAuthToken"in b?a.oauth.TokenClient.call(this,"sellers",b.oAuthToken,"BEARER",b.userId,c):a.oauth.Client.call(this,"sellers",b.oAuthClientId,b.oAuthRedirectUri,b.oAuthScopes,c);var d=this.getUser;this.getUser=function(b,c){return d.call(this,b,c,function(b,d){return new a.resources.sellers.Seller(b,d)})};this.getSeller=function(){return this.getUser()}};a.oauth.TokenClient=function(b,c,d,f,e){d=d||"BEARER";f=f||"me";e=e||{};if(!b)throw Error("'oAuthContext' cannot be empty of undefined");if(!c)throw Error("'oAuthToken' cannot be empty or undefined");var g=this,h,i;e.autologin=!1;a.Client.call(this,b,e);var l=this.init,n=this.reset;this.getTunnel=function(){return h};this.getContext=function(){return b};this.getUserID=function(){return f};this.isAuthenticated=function(){return!Object.isNullOrUndefined(c)};this.signRequest=function(a){if(!d||!c)return!1;a.completedEventWatchers.add(i);a.addHeader("Authorization",String.format("{0} {1}",d.toUpperCase(),c))};this.init=function(b){h=new a.Tunnel.getInstance;h.init(function(){l.call(g,function(){b&&b(!0)})})};this.authenticate=function(){console.warn("I'm sorry, I don't dance OAuth.")};this.reset=function(){n.call(this);h&&h.kill();c=d=f=null};i=new a.base.FunctionPointer(function(b,d){d.getStatusCode()===a.http.statusCodesEnum.NOT_AUTHORIZED&&(console.warn("Greendizer: OAuth token has expired!"),g.reset())},g)};a.resources.AbstractAddress=function(){var b=this,c=function(){return b.getPropertyValue("address")};this.getNumber=function(){if(!Object.isNullOrUndefined(c()))return c().number};this.getStreet=function(){if(!Object.isNullOrUndefined(c()))return c().street};this.getOther=function(){if(!Object.isNullOrUndefined(c()))return c().other};this.getCity=function(){if(c())return c().city};this.getZipCode=function(){if(c())return c().zipcode};this.getCountry=function(){if(c())return c().country};(function(){b.registerProperty(new a.dal.CustomProperty("number","address",function(){return b.getPropertyValue("address").number},function(a){return $.extend(b.getPropertyValue("address")||{},{number:a})}));b.registerProperty(new a.dal.CustomProperty("street","address",function(){return b.getPropertyValue("address").street},function(a){return $.extend(b.getPropertyValue("address")||{},{street:a})}));b.registerProperty(new a.dal.CustomProperty("other","address",function(){return b.getPropertyValue("address").other},function(a){return $.extend(b.getPropertyValue("address")||{},{other:a})}));b.registerProperty(new a.dal.CustomProperty("zipcode","address",function(){return b.getPropertyValue("address").zipcode},function(a){return $.extend(b.getPropertyValue("address")||{},{zipcode:a})}));b.registerProperty(new a.dal.CustomProperty("city","address",function(){return b.getPropertyValue("address").city},function(a){return $.extend(b.getPropertyValue("address")||{},{city:a})}));b.registerProperty(new a.dal.CustomProperty("country","address",function(){return b.getPropertyValue("address").country},function(a){return $.extend(b.getPropertyValue("address")||{},{country:a})}))})()};a.resources.AbstractEditableAddress=function(b){a.resources.AbstractAddress.call(this);this.setNumber=function(a){this.registerUpdate("number",a,b+".Address.Number")};this.setStreet=function(a){this.registerUpdate("street",a,b+".Address.Street")};this.setOther=function(a){this.registerUpdate("other",a,b+".Address.Other")};this.setCity=function(a){this.registerUpdate("city",a,b+".City")};this.setZipCode=function(a){this.registerUpdate("zipcode",a,b+".Zipcode")};this.setCountry=function(a){this.registerUpdate("country",a,b+".Country")}};a.resources.AbstractHistory=function(){this.getCurrencyStats=function(a){return this.getPropertyValue(a)};this.getCurrencies=function(){return this.getPropertyValue("currencies")};this.getName=function(){return this.getPropertyValue("name")};this.getInvoicesCount=function(){return this.getPropertyValue("invoicesCount")};this.getThreadsCount=function(){return this.getPropertyValue("threadsCount")};this.getMessagesCount=function(){return this.getPropertyValue("messagesCount")}};a.resources.Application=function(b,c){a.dal.Resource.call(this,b.getContainerByType(a.dal.dataTypeEnum.APPLICATIONS),c);this.getURI=function(){return String.format("{0}applications/{1}/",b.getURI(),this.getID())};this.getUser=function(){return b};this.getName=function(){return this.getPropertyValue("name")};this.getDescription=function(){return this.getPropertyValue("description")};this.getLargeLogoURL=function(){return this.getPropertyValue("largeLogo")};this.getSmallLogoURL=function(){return this.getPropertyValue("smalllogo")};this.getWebsiteURL=function(){return this.getPropertyValue("website")};this.getPermissions=function(){return this.getPropertyValue("permissions").split(",")};this.getLastUsed=function(){return this.getLastModified()}};a.resources.Company=function(b,c){a.dal.Resource.call(this,b,c);var d=this.toString;this.getURI=function(){return String.format("companies/{0}/",this.getID())};this.getName=function(){return this.getPropertyValue("name")};this.getDescription=function(){return this.getPropertyValue("description")};this.getSmallLogoURL=function(){return this.getPropertyValue("smallLogo")};this.getLargeLogoURL=function(){return this.getPropertyValue("largeLogo")};this.toString=function(a){switch(a){case"name":return this.getName();case"description":return this.getDescription();case"smallLogoURL":return this.getSmallLogoURL();case"largeLogoURL":return this.getLargeLogoURL()}return d.call(this,a)}};a.resources.Email=function(b,c){c&&c.isValidEmail()&&(c=c.toSHA1());var d=this,f;a.dal.Resource.call(this,b.getContainerByType(a.dal.dataTypeEnum.EMAILS),c);var e=this.toString;this.getInvoices=function(b){return f=f||new a.resources.Invoice.InvoiceNode(d,String.format("{0}invoices/",this.getURI()),b||function(b,c){return new a.resources.Invoice(d,c)})};this.getUser=function(){return b};this.getURI=function(){return String.format("{0}emails/{1}/",b.getURI(),this.getID())};this.getLabel=function(){return this.getPropertyValue("label")};this.setLabel=function(a){this.registerUpdate("label",a,"Email.Label")};this.getAddress=function(){if(this.getPropertyValue("address"))return this.getPropertyValue("address");console.error("You have no access to this property.")};this.getVerified=function(){if(this.getPropertyValue("verified"))return this.getPropertyValue("verified");console.error("You have no access to this property.")};this.getPrimary=function(){return b.getPrimaryEmailURI()===this.getURI()};this.setAddress=function(a){this.registerUpdate("address",a)};this.getCreationDate=function(){if(this.getPropertyValue("createdDate"))return new Date(this.getPropertyValue("createdDate"));console.error("You have no access to this property.")};this.toString=function(a){switch(a){case"label":return this.getLabel();case"address":return this.getAddress()}return e.call(this,a)}};a.resources.Employer=function(b){a.resources.Company.call(this,b.getContainerByType(a.dal.dataTypeEnum.COMPANIES));this.getID=function(){return"0"};this.getURI=function(){return String.format("{0}company/",b.getURI())};this.getUser=function(){return b}};a.resources.Invoice=function(b,c){var d=this,f,e,g,h,i;a.dal.Resource.call(this,b.getContainerByType(a.dal.dataTypeEnum.INVOICES),c);var l=this.toString;this.getEmail=function(){return b};this.getBody=function(){return this.getPropertyValue("body")};this.getURI=function(){return String.format("{0}invoices/{1}/",b.getURI(),c)};this.getDefaultFields=function(){return["-body","xslt","payable"]};this.getGroups=function(){if(!e){var b=this.getBody();if(!b)return;e=[];h=g=i=0;$(b).children("groups > group").each(function(){var b=new a.resources.Invoice.Group($(this));h+=b.getDiscountsTotal();g+=b.getTaxesTotal();i+=b.getTotal();e.push(b)})}return e};this.getTotal=function(){i||this.getGroups();return i||Number(this.getPropertyValue("total"))};this.getTaxesTotal=function(){g||this.getGroups();return g};this.getDiscountsTotal=function(){h||this.getGroups();return h};this.getName=function(){return this.getPropertyValue("name")};this.getDescription=function(){return this.getPropertyValue("description")};this.getLocation=function(){return this.getPropertyValue("location")};this.setLocation=function(b){var d="";switch(b){case a.resources.Invoice.locationEnum.INBOX:d="Inbox";break;case a.resources.Invoice.locationEnum.ARCHIVES:d="Archives";break;case a.resources.Invoice.locationEnum.TRASH:d="Trash"}this.registerUpdate("location",v,"Invoice."+d)};this.getCurrency=function(){return this.getPropertyValue("currency")};this.getDate=function(){return new Date(this.getPropertyValue("date"))};this.getDueDate=function(){return Object.isNullOrUndefined(this.getPropertyValue("dueDate"))?null:new Date(this.getPropertyValue("dueDate"))};this.getCanceled=function(){return this.getPropertyValue("canceled")};this.getPaid=function(){return!this.getPropertyValue("paid")||!1};this.getRead=function(){return this.getPropertyValue("read")};this.setRead=function(a){this.registerUpdate("read",a,String.format("Invoice.{0}",a?"Read":"Unread"))};this.getFlagged=function(){return this.getPropertyValue("flagged")};this.setFlagged=function(a){this.registerUpdate("flagged",a,String.format("Invoice.{0}",a?"Flag":"Unflag"))};this.setPaid=function(a){this.registerUpdate("paid",a,String.format("Invoice.{0}",a?"Paid":"Unpaid"))};this.getDaysOverdue=function(){var a=this.getDaysToDueDate();return 0<a?0:Math.abs(Math.floor(a))};this.getDaysToDueDate=function(){return this.getDueDate().substract(new Date,!0).getTotalDays()};this.getDaysFromCreation=function(){return(new Date).substract(this.getDate(),!0).getTotalDays()};this.getSecretKey=function(){return this.getPropertyValue("secretKey")};this.toXMLi=function(a){if(f)return f;var b=[];a||(b.push('<?xml version="1.0" encoding="UTF-8"?>'),b.push("<invoice>"));b.push(String.format("<{0}>{1}</{0}>","id",this.getID()));b.push(String.format("<{0}><![CDATA[{1}]]\></{0}>","name",this.getName()));b.push(String.format("<{0}><![CDATA[{1}]]\></{0}>","description",this.getDescription()));b.push(String.format("<{0}>{1}</{0}>","currency",this.getCurrency()));b.push(String.format("<{0}>{1}</{0}>","date",this.getDate().toString("%XML")));b.push(String.format("<{0}>{1}</{0}>","dueDate",this.getDueDate().toString("%XML")));b.push(String.format("<{0}>{1}</{0}>","total",this.getTotal()));a||b.push("</invoice>");return f=b.join(String.EMPTY)};this.toString=function(a){switch(a){case"name":return this.getName();case"description":return this.getDescription();case"total":return this.getTotal().toString();case"xmli":return this.toXMLi();default:return l.call(this,a)}};(function(){d.registerProperty(new a.dal.CustomProperty("emailID","emailID",function(){return b.getID()},function(){throw Error("Property is read-only.");}))})()};a.resources.Invoice.Group=function(b){var c=[],d,f,e;this.getName=function(){return b.children("name").text()};this.getDescription=function(){return b.children("description").text()};this.getLines=function(){return c.slice(0)};var g=function(){for(var a=e=f=d=0;a<c.length;a++)d+=c[a].getTotal(),e+=c[a].getDiscountsTotal(),f+=c[a].getTaxesTotal()};this.getTaxesTotal=function(){f||g();return f};this.getDiscountsTotal=function(){e||g();return e};this.getTotal=function(){d||g();return d};(function(){b.find("lines line").each(function(){c.push(new a.resources.Invoice.Line($(this)))})})()};a.resources.Invoice.Line=function(b){var c=this,d=0,f=0,e=0,g=0,h=[],i=[];this.getDate=function(){return new Date(b.children("date").text())};this.getName=function(){return b.children("name").text()};this.getDescription=function(){return b.children("description").text()};this.getQuantity=function(){return Number(b.children("quantity").text())};this.getUnitPrice=function(){return Number(b.children("unitPrice").text())};this.getTaxes=function(){return h.slice(0)};this.getDiscounts=function(){return i.slice(0)};this.getTaxesTotal=function(){for(var a=g=0;a<h.length;a++)g+=h[a].compute(f);return g};this.getDiscountsTotal=function(){for(var a=e=0;a<i.length;a++)e+=i[a].compute(d);return e=Math.min(e,d)};this.getTotal=function(){f=d-(e||this.getDiscountsTotal());return f+(g||this.getTaxesTotal())};(function(){d=c.getQuantity()*c.getUnitPrice();b.find("taxes > tax").each(function(){h.push(new a.resources.Invoice.Treatment($(this)))});b.find("discounts > discount").each(function(){i.push(new a.resources.Invoice.Treatment($(this)))})})()};a.resources.Invoice.Treatment=function(b){this.getName=function(){return b.attr("name")};this.getDescription=function(){return b.attr("description")};this.getRate=function(){return Number(b.text())};this.getBaseInterval=function(){if(b.attr("base"))return a.resources.Invoice.BaseInterval.parse(b.attr("base"))};this.getType=function(){return b.attr("type")};this.compute=function(a){if("fixed"===this.getType())return this.getRate();if(this.getBaseInterval()){if(a>this.getBaseInterval().getLower())return Math.min(a,this.getBaseInterval().getUpper())*this.getRate()/100}else return a*this.getRate()/100;return 0}};a.resources.Invoice.BaseInterval=function(a,c){this.getLower=function(){return a||0};this.getUpper=function(){return c||Number.MAX_VALUE}};a.resources.Invoice.BaseInterval.parse=function(b){b=b.substr(1,b.length-2).split(",");return new a.resources.Invoice.BaseInterval(Number(b[0]),1<b.length?Number.MAX_VALUE:Number(b[1]))};a.resources.Invoice.InvoiceNode=function(b,c,d){a.dal.Node.call(this,b.getContainerByType(a.dal.dataTypeEnum.INVOICES),c,d);var f=this.search;this.getEmail=function(){return b};this.search=function(a,d,c){var i=["emailID=="+b.getID()];c&&i.push(c);return f.call(this,a,d,i.join("|"))};this.getUnread=function(a){return this.search("read==0|location<<2",a)};this.getFlagged=function(a){return this.search("flagged==1|location<<2",a)};this.getDue=function(a){return this.search("paid==0|location<<2|canceled==0",a)};this.getOverdue=function(a){return this.search("paid==0|location<<2|canceled==0|dueDate>>"+(new Date).getTime(),a)};this.getArchived=function(a){return this.search("location==1",a)};this.getTrashed=function(a){return this.search("location==2",a)}};a.resources.Invoice.locationEnum={INBOX:0,ARCHIVES:1,TRASH:2};a.resources.Message=function(b,c){a.dal.Resource.call(this,b.getContainerByType(a.dal.dataTypeEnum.MESSAGES),c);var d=this.toString;this.getURI=function(){return String.format("{0}messages/{1}/",b.getURI(),this.getID())};this.getThread=function(){return b};this.getText=function(){return this.getPropertyValue("text")};this.isFromCurrentUser=function(){return Object.isNullOrUndefined(this.getPropertyValue("sender"))};this.toString=function(a){switch(a){case"text":return this.getText()}return d.call(this,a)}};a.resources.Settings=function(b){a.dal.Resource.call(this,b.getContainerByType(a.dal.dataTypeEnum.SETTINGS));var c=this.toString;this.getID=function(){return"0"};this.getUser=function(){return b};this.getURI=function(){return b.getURI()+"settings/"};this.getCurrency=function(){return this.getPropertyValue("currency")};this.setCurrency=function(a){this.registerUpdate("currency",a)};this.getLanguage=function(){return this.getPropertyValue("language").toLowerCase()};this.setLanguage=function(a){this.registerUpdate("language",a)};this.getRegion=function(){return this.getPropertyValue("region")};this.setRegion=function(a){this.registerUpdate("region",a)};this.toString=function(a){switch(a){case"currency":return this.getCurrency();case"language":return this.getLanguage();case"region":return this.getRegion()}return c.call(this,a)}};a.resources.Thread=function(b,c){var d=this,f;a.dal.Resource.call(this,b,c);var e=this.toString;this.getMessages=function(b){return f=f||new a.dal.Node(this.getContainerByType(a.dal.dataTypeEnum.MESSAGES),String.format("{0}messages/",this.getURI()),b||function(b,c){return new a.resources.Message(d,c)})};this.getURI=function(){return String.format("{0}threads/{1}/",b.getClient().getUserURI(),this.getID())};this.getMessagesCount=function(){return this.getPropertyValue("count")};this.getLocation=function(){return this.getPropertyValue("location")};this.getSubject=function(){return this.getPropertyValue("subject")};this.getSnippet=function(){return this.getPropertyValue("snippet")};this.getLastMessageDate=function(){return new Date(this.getPropertyValue("lastMessage"))};this.getCreationDate=function(){return new Date(this.getPropertyValue("creationDate"))};this.getRead=function(){return this.getPropertyValue("read")};this.getFlagged=function(){return this.getPropertyValue("flagged")};this.setRead=function(){this.registerUpdate("read",value,String.format("Thread.{0}",value?"Read":"Unread"))};this.setFlagged=function(a){this.registerUpdate("flagged",a,String.format("Thread.{0}",a?"Flag":"Unflag"))};this.setLocation=function(d){var c=a.models[b.getClient().getType()].LocationsEnum,e="";switch(d){case c.INBOX:e="Inbox";break;case c.ARCHIVES:e="Archives";break;case c.TRASH:e="Trash"}this.registerUpdate("location",d,"Thread."+e)};this.toString=function(a){switch(a){case"subject":return this.getSubject();case"snippet":return this.getSnippet()}return e.call(this,a)}};a.resources.Thread.ThreadNode=function(b,c,d){a.dal.Node.call(this,b,c,d);this.getUnread=function(a){return this.search("read==0",a)};this.getFlagged=function(a){return this.search("flagged==1",a)};this.getInbox=function(a){return this.search("location==0",a)};this.getArchived=function(a){return this.search("location==1",a)};this.getTrashed=function(a){return this.search("location==2",a)};this.open=function(f,e,g,h,i){g={origin:a.http.requestOriginEnum.RESOURCE,type:this.getType(),entity:this,description:"Threads.Create"};g=new a.http.Request(b.getClient(),a.http.httpMethodsEnum.POST,c,g);g.setData({recipient:f,subject:e,message:message});g.getResponse(function(c){if(c.getStatusCode()!==a.http.statusCodesEnum.CREATED)return i&&i(c);var e=d(b,a.base.extractId(c.getLocation())),f=c.getData();f[a.dal.resourceColumnEnum.ETAG]=c.getEtag().toString();e.sync(f,a.dal.dataSourceEnum.SERVER,h,h);return e})}};a.resources.Thread.locationEnum={INBOX:0,ARCHIVES:1,TRASH:2};a.resources.User=function(b,c){var d=this,f,e,g;a.dal.Resource.call(this,b,c);a.resources.AbstractEditableAddress.call(this,"Profile");var h=this.toString;this.getEmails=function(b){return f=f||new a.dal.Node(this.getContainerByType(a.dal.dataTypeEnum.EMAILS),String.format("{0}emails/",this.getURI()),b||function(b,c){return new a.resources.Email(d,c)})};this.getApplications=function(b){return e=e||new a.dal.Node(this.getContainerByType(a.dal.dataTypeEnum.APPLICATIONS),String.format("{0}applications/",this.getURI()),b||function(b,c){return new a.resources.Application(d,c)})};this.getEvents=function(b){return g=g||new a.dal.Node(this.getContainerByType(a.dal.dataTypeEnum.USEREVENTS),String.format("{0}events/",this.getURI()),b||function(b,c){return new a.resources.UserEvent(d,c)})};this.getSettings=function(b,c){return this.getContainerByType(a.dal.dataTypeEnum.SETTINGS).findResource(null,b,c,function(){return new a.resources.Settings(d)})};this.getCompany=function(b,c){return this.getContainerByType(a.dal.dataTypeEnum.COMPANIES).findResource(null,b,c,function(){return new a.resources.Employer(d)})};this.getURI=function(){throw Error("Not implemented");};this.getFirstname=function(){return this.getPropertyValue("firstname")};this.setFirstname=function(a){this.registerUpdate("firstname",a,"Profile.Firstname")};this.getLastname=function(){return this.getPropertyValue("lastname")};this.setLastname=function(a){this.registerUpdate("lastname",a,"Profile.Lastname")};this.getFullname=function(){return String.format("{0} {1}",this.getFirstname(),this.getLastname())};this.getAvatarURL=function(){return this.getPropertyValue("avatar")};this.getBirthday=function(){return new Date(this.getPropertyValue("birthday"))};this.setBirthday=function(a){this.registerUpdate("birthday",a,"Profile.Birthday")};this.getGender=function(){return this.getPropertyValue("gender")};this.setGender=function(a){this.registerUpdate("gender",a,"Profile.Gender")};this.getPrimaryEmail=function(d,c){this.getPropertyValue("primaryEmailId")||(console.error("You don't have access to this property"),c&&c());return b.getClient().FindResource(a.dal.DataTypeEnum.EMAILS,this.getPropertyValue("primaryEmailID"),d,c)};this.setPrimaryEmail=function(a){this.registerUpdate("primaryEmailID",a.getID(),"Profile.PrimaryEmail")};this.changePassword=function(b,d,c,e){var f={origin:a.http.requestOriginEnum.RESOURCE,type:this.getType(),entity:this,description:"Profile.Password"},f=new a.http.Request(a.http.HttpMethodsEnum.POST,this.getURI(),f);f.setData({currentPassword:b,newPassword:d});f.getResponse(function(b){b.getStatusCode()===a.http.statusCodesEnum.NO_CONTENT?c&&c():e&&e(b)})};this.remove=function(b,c,e){var f={origin:a.http.requestOriginEnum.RESOURCE,type:this.getType(),entity:this,description:"Resources.Delete"},f=new a.http.Request(a.http.HttpMethodsEnum.DELETE,this.getURI(),f);f.setCredentials(d.getPrimaryEmail().getAddress(),b);f.getResponse(function(b){b.getStatusCode()===a.http.statusCodesEnum.NO_CONTENT?c&&c():e&&e(b)})};this.toString=function(a){switch(a){case"firstname":return this.getFirstname();case"lastname":return this.getLastname();case"fullname":return this.getFullname();case"avatarURL":return this.getAvatarURL()}return h.call(this,a)};(function(){d.registerProperty(new a.dal.CustomProperty("primaryEmailId","primaryEmailURI",function(){var b=d.getPropertyValue("primaryEmailURI");if(b)return a.base.extractID(b)},function(a){return String.format("{0}emails/{1}/",user.getURI(),a)}))})()};a.resources.UserEvent=function(b){a.dal.Resource.call(this,b.getContainerByType(a.dal.dataTypeEnum.USEREVENTS));this.getURI=function(){return String.format("{0}events/{1}/",b.getURI(),this.getCode())};this.getUser=function(){return b};this.getCode=function(){return this.getPropertyValue("code")};this.getValue=function(){return this.getPropertyValue("value")}};a.resources.buyers.Buyer=function(b,c){var d=this;a.resources.User.call(this,b,c);var f=this.getEmails;this.getURI=function(){return String.format("buyers/{0}/",this.getID())};this.getEmails=function(){return f.call(this,function(b,c){return new a.resources.buyers.Email(d,c)})}};a.resources.buyers.Email=function(b,c){var d=this,f,e;a.resources.Email.call(this,b,c);var g=this.getInvoices;this.getInvoices=function(){return g.call(this,function(b,c){return new a.resources.buyers.Invoice(d,c)})};this.getThreads=function(){return f=f||new a.resources.buyers.Thread.ThreadNode(this)};this.getSellers=function(){return e=e||new a.resources.buyers.SellerHistory.SellerHistoryNode(this)}};a.resources.buyers.Invoice=function(b,c){var d=this;a.resources.Invoice.call(this,b,c);this.getSeller=function(b,c){return this.getContainerByType(a.dal.dataTypeEnum.COMPANIES).findResource(a.base.extractID(this.getPropertyValue("sellerURI")),b,c,function(b,c){return new a.resources.Company(b,c)})};(function(){d.registerProperty(new a.dal.CustomProperty("seller","seller",function(){return a.base.extractID(d.getPropertyValue("sellerURI"))},function(){throw Error("Property is read-only.");}))})()};a.resources.buyers.SellerHistory=function(b,c){a.resources.User.call(this,b.getContainerById(a.dal.dataTypeEnum.SELLERHISTORIES),c);a.resources.AbstractHistory.call(this);this.getURI=function(){return String.format("{0}sellers/{1}/",b.getURI(),this.getID())};this.getEmail=function(){return b};this.getCompany=function(b,c){return!this.getProperyValue("companyURI")?void 0:container.getContainerByType(a.dal.dataTypeEnum.COMPANIES).findResource(a.base.extractID(this.getPropertyValue("companyURI")),b,c,function(b,c){return new a.resources.Company(b,c)})}};a.resources.buyers.SellerHistory.SellerHistoryNode=function(b){a.dal.Node.call(this,b.getContainerByType(a.dal.dataTypeEnum.SELLERHISTORIES),b.getURI()+"sellers/",function(c,f){return new a.resources.buyers.SellerHistory(b,f)});var c=this.search;this.search=function(a,f,e){var g=["emailID=="+b.getID()];e&&g.push(e);return c.call(this,a,f,g.join("|"))}};a.resources.buyers.Thread=function(b,c){a.resources.Thread.call(this,b.getContainerByType(a.dal.dataTypeEnum.THREADS),c);this.getEmail=function(){return b};this.getURI=function(){return String.format("{0}threads/{1}/",b.getURI(),this.getID())};this.getSeller=function(b,c){return this.getContainerByType(a.dal.dataTypeEnum.COMPANIES).findResource(a.base.extractID(this.getPropertyValue("sellerURI")),b,c,function(b,c){return new a.resources.Company(b,c)})}};a.resources.buyers.Thread.ThreadNode=function(b){a.resources.Thread.ThreadNode.call(this,b.getContainerByType(a.dal.dataTypeEnum.THREADS),b.getURI()+"threads/",function(c,f){return new a.resources.buyers.Thread(b,f)});var c=this.search;this.search=function(a,f,e){var g=["emailID=="+b.getID()];e&&g.push(e);return c.call(this,a,f,g.join("|"))}};a.resources.sellers.Buyer=function(b,c){a.dal.Resource.call(this,b.getContainerByType(a.dal.dataTypeEnum.BUYERS),c);a.resources.AbstractAddress.call(this);a.resources.AbstractHistory.call(this);this.getURI=function(){return String.format("{0}sellers/{1}",b.getURI(),this.getID())};this.getUser=function(){return b}};a.resources.sellers.Email=function(b,c){var d=this,f,e;a.resources.Email.call(this,b,c);this.getInvoices=function(){return f=f||new a.resources.sellers.Invoice.InvoiceNode(this,String.format("{0}invoices/",this.getURI()),function(b,c){return new a.resources.sellers.Invoice(d,c)})};this.getInvoiceReports=function(){return e=e||new a.resources.sellers.InvoiceReport.InvoiceReportNode(this)}};a.resources.sellers.Invoice=function(b,c){var d=this;a.resources.Invoice.call(this,b,c);this.getBuyer=function(b,c){return this.getContainerByType(a.dal.dataTypeEnum.BUYERS).findResource(a.base.extractID(this.getPropertyValue("buyerURI")),b,c,function(b,c){return new a.resources.sellers.Buyer(b,c)})};this.customID=function(){return this.getPropertyValue("customId")};this.cancel=function(a,b){this.registerUpdate("canceled",!0);this.update(a,b)};(function(){d.registerProperty(new a.dal.CustomProperty("buyerName","buyer",function(){return(d.getPropertyValue("buyer")||{}).name},function(){throw Error("Property is read-only");}));d.registerProperty(new a.dal.CustomProperty("buyerEmail","buyer",function(){return(d.getPropertyValue("buyer")||{}).email},function(){throw Error("Property is read-only");}));d.registerProperty(new a.dal.CustomProperty("buyerURI","buyer",function(){return(d.getPropertyValue("buyer")||{}).uri},function(){throw Error("Property is read-only");}));d.registerProperty(new a.dal.CustomProperty("buyerAddress","buyer",function(){return(d.getPropertyValue("buyer")||{}).address},function(){throw Error("Property is read-only");}));d.registerCustomTest("buyer",function(a,b){for(var c=0;c<a.length;c++)if(d.getPropertyValue("buyerEmail")===a[c])return b&&b(!0),!0;b&&b(!1);return!1})})()};a.resources.sellers.Invoice.InvoiceNode=function(b,c,d){a.resources.Invoice.InvoiceNode.call(this,b,c,d);this.getOutbox=function(a){return this.search("location==0",a)};this.send=function(d,e,g){d={origin:a.http.requestOriginEnum.RESOURCE,type:this.getType(),entity:this,description:"Invoices.Create"};(new a.http.Request(container.getClient(),a.http.httpMethodsEnum.POST,c,d)).getResponse(function(c){if(c.getStatusCode()!==a.http.statusCodesEnum.ACCEPTED)return g&&g(c);var d=new a.resources.sellers.InvoiceReport(b,a.base.extractId(c.getLocation())),f=c.getData();f[a.dal.resourceColumnEnum.ETAG]=c.getEtag().toString();d.sync(f,a.dal.dataSourceEnum.SERVER,e,e);return d})}};a.resources.sellers.InvoiceReport=function(b,c){a.dal.Resource.call(this,b.getContainerByType(a.dal.dataTypeEnum.INVOICEREPORTS),c);this.getURI=function(){return String.format("{0}invoices/reports/{1}",b.getURI(),this.getID())};this.getEmail=function(){return b};this.getStartTime=function(){return new Date(this.getPropertyValue("startTime"))};this.getEndTime=function(){return new Date(this.getPropertyValue("startTime")+this.getPropertyValue("elapsedTime"))};this.getState=function(){return Number(this.getPropertyValue("state"))||0};this.getInvoicesCount=function(){return Number(this.getPropertyValue("invoicesCount"))};this.getIPAddress=function(){return this.getPropertyValue("ipAddress")};this.getHash=function(){return this.getPropertyValue("hash")}};a.resources.sellers.InvoiceReport.InvoiceReportNode=function(b){a.dal.Node.call(this,b.getContainerByType(a.dal.dataTypeEnum.INVOICEREPORTS),b.getURI()+"invoices/reports/",function(c,f){return new a.resources.sellers.InvoiceReport(b,f)});var c=this.search;this.search=function(a,f,e){var g=["emailID=="+b.getID()];e&&g.push(e);return c.call(this,a,f,g.join("|"))}};a.resources.sellers.Seller=function(b,c){var d=this,f,e;a.resources.User.call(this,b,c);var g=this.getEmails;this.getURI=function(){return String.format("sellers/{0}/",this.getID())};this.getEmails=function(){return g.call(this,function(b,c){return new a.resources.sellers.Email(d,c)})};this.getBuyers=function(b){return e=e||new a.dal.Node(this.getContainerByType(a.dal.dataTypeEnum.BUYERS),String.format("{0}threads/",this.getURI()),b||function(b,c){return new a.resources.sellers.Buyer(d,c)})};this.getThreads=function(b){return f=f||new a.resources.Thread.ThreadNode(this.getContainerByType(a.dal.dataTypeEnum.THREADS),String.format("{0}threads/",this.getURI()),b||function(b,c){return new a.resources.Thread(d,c)})}};a.resources.sellers.Thread=function(b,c){a.resources.Thread.call(this,b.getContainerByType(a.dal.dataTypeEnum.THREAD),c);this.getUser=function(){return b};this.getURI=function(){return String.format("{0}threads/{1}/",b.getURI(),this.getID())};this.getBuyer=function(b,c){return this.getContainerByType(a.dal.dataTypeEnum.BUYERS).findResource(a.base.extractID(this.getPropertyValue("buyerURI")),b,c,function(b,c){return new a.resources.sellers.Buyer(b,c)})}}})();